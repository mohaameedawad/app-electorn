<div class="reports-container" id="reportCards">
  <div class="row">
    <div class="col-md-10">
      <div class="row g-3">
        <div class="col-md-4" *ngFor="let card of reportCards">
          <div class="report-card" (click)="openReport(card.type)">
            <i [class]="card.icon + ' report-icon'"></i>
            <h4>{{ card.title }}</h4>
            <p>{{ card.description }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ðŸŸ¢ Unified Report Dialog -->
<app-dialog
  [(visible)]="displayReportDialog"
  [width]="'80vw'"
  [header]="reportTitles[currentReport]"
>
  <div class="p-4">
    <!-- ====== filters per report ====== -->

    <!-- Ù…ØµØ±ÙˆÙØ§Øª / Ù…Ø¯ÙÙˆØ¹Ø§Øª / Ù…Ø´ØªØ±ÙŠØ§Øª -->
    <div
      *ngIf="['expenses', 'payments', 'purchases'].includes(currentReport)"
      class="row mb-3"
    >
      <div class="col-md-3">
        <label class="mb-2">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
        <p-datepicker
          [(ngModel)]="dateFrom"
          dateFormat="yy-mm-dd"
          [showIcon]="true"
          styleClass="w-100"
        ></p-datepicker>
      </div>

      <div class="col-md-3">
        <label class="mb-2">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
        <p-datepicker
          [(ngModel)]="dateTo"
          dateFormat="yy-mm-dd"
          [showIcon]="true"
          styleClass="w-100"
        ></p-datepicker>
      </div>

      <div class="col-md-2 mt-4 pt-1">
        <p-button label="Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±" (onClick)="generateReport()"></p-button>
      </div>
    </div>

    <!-- ÙƒØ´Ù Ø­Ø³Ø§Ø¨ Ø¹Ù…ÙŠÙ„ -->
    <div *ngIf="currentReport === 'customer'" class="row mb-3">
      <div class="col-md-3">
        <label class="mb-2">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
        <p-select
          [(ngModel)]="selectedCustomer"
          [options]="customers"
          optionLabel="name"
          placeholder="Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…ÙŠÙ„"
          styleClass="w-100"
          (onChange)="generateReport()"
        ></p-select>
      </div>
    </div>

    <!-- ÙƒØ´Ù Ø­Ø³Ø§Ø¨ Ù…ÙˆØ±Ø¯ -->
    <div *ngIf="currentReport === 'supplier'" class="row mb-3">
      <div class="col-md-3">
        <label class="mb-2">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ±Ø¯</label>
        <p-select
          [(ngModel)]="selectedSupplier"
          [options]="suppliers"
          optionLabel="name"
          optionValue="id"
          placeholder="Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ±Ø¯"
          styleClass="w-100"
          (onChange)="generateReport()"
        ></p-select>
      </div>
    </div>

    <!-- ====== TABLE OUTPUT (Unified Table) ====== -->
    <div class="report-preview" id="reportPreview">
      <app-table
        [columns]="currentColumns"
        [data]="currentData"
        [showFilter]="false"
      >
      </app-table>
    </div>
  </div>

  <div dialog-footer class="dialog-footer">
    <p-button
      label="Ø¥ØºÙ„Ø§Ù‚"
      severity="secondary"
      [text]="true"
      (onClick)="closeReport()"
    ></p-button>
    <p-button
      label="Ø·Ø¨Ø§Ø¹Ø©"
      icon="pi pi-print"
      (onClick)="printPreview()"
    ></p-button>
  </div>
</app-dialog>

<!-- Hidden Print Template -->
<div id="reportPrint" style="display: none">
  <div class="print-header">
    <h1>{{ reportTitles[currentReport] }}</h1>

    <!-- Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
    <h2 *ngIf="currentReport === 'customer' && selectedCustomer">
      Ø§Ù„Ø¹Ù…ÙŠÙ„: {{ selectedCustomer.name }}
    </h2>

    <!-- Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯ -->
    <h2 *ngIf="currentReport === 'supplier' && selectedSupplier">
      Ø§Ù„Ù…ÙˆØ±Ø¯: {{ selectedSupplier?.name }}
    </h2>

    <hr />
  </div>

  <table class="print-table">
    <thead>
      <tr>
        <th *ngFor="let col of currentColumns">{{ col.header }}</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let row of currentData">
        <td *ngFor="let col of currentColumns">
          {{ row[col.field] }}
        </td>
      </tr>
    </tbody>
  </table>
</div>
<app-confirmation-dialog></app-confirmation-dialog>
